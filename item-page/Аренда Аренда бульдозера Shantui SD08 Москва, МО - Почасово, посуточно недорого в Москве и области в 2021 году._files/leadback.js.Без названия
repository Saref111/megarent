(function(){this.inArray=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1},this.glob=function(e){for(var t=e.split("."),o=window,i=0,n=t.length;i<n;i++)a=t[i],o[a]=o[a]||{},o=o[a];return o},glob("ldbck");var e,t,o,i,n,l,k=ldbck;if(window._emv){if(window.ldbck_loaded)return k.log("multiple instance detected"),!1;window.ldbck_loaded=!0}if(k.DEBUG=!1,k.ACCEPT_CHATS=!1,k.version="v1.12.99b02062021",k.DOMAIN=k.DEBUG?"leadback.local":"string"==typeof _emv.cdn?_emv.cdn:"leadback.ru",k.CHAT_CDN=k.DEBUG?"//cloudim.local/js/":"//cloudim.ru/js/",k.JQUERY_URL="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js?ldbck_v="+k.version,k.JS_CDN="//"+k.DOMAIN+"/js/",k.PUBLIC_SERVER=(k.DEBUG?"//":"https://")+k.DOMAIN+"/",k.JQUERY_VERSIONS="3.3.1 3.2.1 3.1.1 2.2.4 2.1.1 1.12.4 1.11.3 1.11.2 1.11.1 1.11.0 1.10.2 1.10.1 1.10.0 1.9.1 1.9.0".split(" "),k.LAST_SPEED=k.LEAVE_POINT=k.LAST_X_POSITION=k.LAST_Y_POSITION=0,k.timer=27e3,k.activity=0,k.clock=null,k.stat={x:null,y:null,s:null,t:0,a:0,l:0},k.total_time=0,k.last_visit_timeout=0,k.Chat={},k.storage=null,k.dom_is_ready=null,k.restarted=!1,k.is_multibutton=null,k.$multibutton=null,k.beforeOpenWidget=null,k.successCallCallback=null,"function"==typeof _emv.successCallCallback&&(k.successCallCallback=_emv.successCallCallback),k.onApiReady=[],"function"==typeof _emv.onApiReady)k.onApiReady.push(_emv.onApiReady);else if("object"==typeof _emv.onApiReady)for(var r=0,s=_emv.onApiReady.length;r<s;r++)"function"==typeof _emv.onApiReady[r]&&k.onApiReady.push(_emv.onApiReady[r]);k.is_vk=_emv.is_vk||!1,k.debug_window=_emv.debug_window||!1;try{k.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),k.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)}catch(e){}h=_emv.campaign,k.cc="__leadback_"+h,k.ct="__leadback_timeout_"+h,k.cg="__leadback_guid_"+h,k.storage_type="cookie",k.countDownInterval=null,k.replacedTags={},-1!=k.DOMAIN.indexOf("leadback.")&&(window.GoogleAnalyticsObject||(e=window,t=document,o="script",i="ga",e.GoogleAnalyticsObject=i,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,n=t.createElement(o),l=t.getElementsByTagName(o)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",l.parentNode.insertBefore(n,l)),"function"==typeof ga&&(ga("create","UA-53479583-2","auto",{name:"ldbckTracker"}),ga("ldbckTracker.send","pageview"))),k.ga_cid=null,"function"==typeof ga&&ga(function(){k.getGoogleCid()});var d=0,u=setInterval(function(){d++,k.getGoogleCid()?(k.log("Ga cid found",k.getGoogleCid()),u&&(clearInterval(u),u=null)):5<d&&(u&&(clearInterval(u),u=null),k.log("Ga cid not found by interval"))},500);k.getGoogleCid=function(){return null===k.ga_cid&&"function"==typeof ga&&"function"==typeof ga.getAll&&ga.getAll().length&&(k.ga_cid=ga.getAll()[0].get("clientId"),u&&(clearInterval(u),u=null)),k.log("getGoogleCid",k.ga_cid),k.ga_cid},k.ya=[],k.ya_cid=null;var g=0,p=setInterval(function(){for(var e in g++,window)0==e.indexOf("yaCounter")&&("function"==typeof window[e].getClientID&&null===k.ya_cid&&(k.ya_cid=window[e].getClientID(),k.log("YA CID:"+k.ya_cid)),"function"==typeof window[e].reachGoal&&(k.ya[k.ya.length]=e,k.log("Ya: "+k.ya.length)));0<k.ya.length?clearInterval(p):5<g&&(clearInterval(p),k.log("Ya not found"))},500);function _(){for(var e=0,t={};e<arguments.length;e++){var o=arguments[e];for(var i in o)t[i]=o[i]}return t}if(k.init=function(){k.log("init");try{var e=document.location.href,t=-1!==e.indexOf("&_cobrowsing=true")||-1!==e.indexOf("?_cobrowsing=true");if(window!=window.top&&!k.is_vk||t)return void k.log("in frame")}catch(e){}k.activity=k.DEBUG?1:k.randomVal(10,20),k.$.ajaxSetup({async:!0}),k.storage_type="local";try{void 0!==k.Cookies.get("__leadback_ver")&&(k.Cookies.remove(k.cc,{path:"/"}),k.Cookies.remove(k.ct,{path:"/"}),k.Cookies.remove("__leadback_ver",{path:"/"}))}catch(e){}return k.log("Storage type is: "+k.storage_type),k.storage=k.initStorage(_emv.campaign),k.initWidget()},k.getStorageType=function(e){var t=k.storage_type;return e!=k.cg||k.is_vk||(t="cookie"),t},k.getCookie=function(e){var t=k.getStorageType(e);if("cookie"==t)return k.Cookies.getJSON(e);if("local"==t){var o=k.storage.localStorage.get(e);return void 0===o?o:void 0!==o.expires&&"string"==typeof o.expires&&new Date(o.expires)<new Date?void k.removeCookie(e):o.value}},k.setCookie=function(e,t,o){var i=k.getStorageType(e);return"cookie"==i?k.Cookies.set(e,t,o):"local"==i?(void 0===o.expires&&(o.expires=0),k.storage.localStorage.set(e,{value:t,expires:o.expires})):void 0},k.removeCookie=function(e,t){var o=k.getStorageType(e);return"cookie"==o?k.Cookies.remove(e,t):"local"==o?k.storage.localStorage.remove(e):void 0},k.restart=function(e){return k.restarted=!0,k.unloadWidget(),k.timer=27e3,k.clock=null,k.stat={x:null,y:null,s:null,t:0,a:0,l:0},k.total_time=0,k.last_visit_timeout=0,k.Chat={},k.storage=null,k.dom_is_ready=null,e&&k.restartStorage(e),k.$("#lb_widget-root").remove(),k.initWidget()},k.restartStorage=function(e){_emv.campaign=e,k.cc="__leadback_"+e,k.ct="__leadback_timeout_"+e,k.cg="__leadback_guid_"+e,k.storage=k.initStorage(e)},k.initWidget=function(){if(k.log("initWidget"),"#demomode"!=window.location.hash&&"#debug"!=window.location.hash||(k.log("Demo mode ON"),k.removeCookie(k.cc,{path:"/"}),k.removeCookie(k.ct,{path:"/"}),void 0!==k.getCookie(k.cg)&&k.setCookie(k.cg,{guid:k.getCookie(k.cg).guid,converted:!1,t:k.getCookie(k.cg).t},{path:"/",expires:99999})),c=function(){k.$.ajax({type:"GET",url:k.PUBLIC_SERVER+"backend/widget_data.php",dataType:"json",data:{widget_key:_emv.campaign,h:window.location.host,cache:Math.random(),tz_offset:k.getTz()},success:function(e){var t;k.log("Campaign Loaded from Server",e),void 0===e.widget_key&&k.log("Invalid widget_key"),t=new Date((new Date).getTime()+18e4);var o=!(k.W={widget_key:e.widget_key,user_id:e.user_id,active:e.active,night_mode:e.night_mode,catch_on_exit:e.catch_on_exit,catch_by_timer:e.catch_by_timer,catch_by_timer_time:e.catch_by_timer_time,allow_multiple_conversions:e.multiple_conversions,timeout:e.timeout,callback_time:e.callback_time,float_button:e.float_button,mobile_button:e.mobile_button,country:e.country?e.country:"ru",lang:e.lang?e.lang:"ru",position:e.position,chat:e.chat?e.chat:0,chat_uid:e.chat_uid?e.chat_uid:0,chat_id:e.chat_id?e.chat_id:0,tooltip_scroll:e.tooltip_scroll,tooltip_hover:e.tooltip_hover,suitable_time:e.suitable_time,magic_forms:e.magic_forms,magic_forms_callback:e.magic_forms_callback,magic_forms_night_mode:e.magic_forms_night_mode,facebook_pixel_id:e.facebook_pixel_id?e.facebook_pixel_id:"",facebook_pixel_event:e.facebook_pixel_event?e.facebook_pixel_event:"",status:e.status,block_desc:e.block_desc,hide_call_timer:e.hide_call_timer,faq_settings:e.faq_settings});return k.W.widget_key!=_emv.campaign&&(k.log("is_geo_office = true"),k.storage=null,k.restartStorage(k.W.widget_key),o=!0),e.chat&&e.chat_uid&&e.chat_data&&(e.chat_data.operators&&k.storage.localStorage.set("chat_operators",e.chat_data.operators),e.chat_data.settings&&(k.storage.localStorage.set("chat_settings",e.chat_data.settings),k.W.chat_init="hide")),void 0!==e.url_config&&void 0!==e.url_config.urls&&0<e.url_config.urls.length?k.storage.localStorage.set("url_config",e.url_config):k.storage.localStorage.remove("url_config"),void 0!==e.scheduler&&void 0!==e.scheduler.days&&void 0!==e.scheduler.times?k.storage.localStorage.set("scheduler",e.scheduler):k.storage.localStorage.remove("scheduler"),void 0!==e.departments&&1<e.departments.length?k.storage.localStorage.set("departments",e.departments):k.storage.localStorage.remove("departments"),k.setCookie(k.cc,k.W,{path:"/",expires:t}),o?k.initWidget():k.campaignLoaded(e)},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpCallback"})},k.restarted||(k.$(window).on("beforeunload",function(){k.unloadWidget()}),setInterval(function(){k.stat.t++,k.total_time++,k.stat.a=k.total_time},1e3)),void 0===k.getCookie(k.cg))return b=ldbck.generateUUID(),k.setCookie(k.cg,{guid:b,converted:!1,t:0},{path:"/",expires:99999}),ldbck.log("New GUID Cookie Created"),k.removeCookie(k.cc,{path:"/"},c());if(ldbck.log("Loaded GUID Cookie"),k.total_time=k.getCookie(k.cg).t,void 0!==k.getCookie(k.cg).l&&(k.last_visit_timeout=Math.round(((new Date).getTime()-k.getCookie(k.cg).l)/1e3)),k.log("self.last_visit_timeout="+k.last_visit_timeout),void 0===k.getCookie(k.cc))return c();if(ldbck.log("Campaign Loaded from Cookie"),b=k.getCookie(k.cc),b.chat&&b.chat_uid&&!0===k.storage.localStorage.isEmpty("chat_operators"))return k.log("force LOAD Campaign (empty storage)"),c();k.W=b;try{clearInterval(k.countDownInterval)}catch(e){}return k.campaignLoaded(b)},k.unloadWidget=function(){if(void 0!==k.getCookie(k.cg)&&(k.setCookie(k.cg,{guid:k.getCookie(k.cg).guid,converted:k.getCookie(k.cg).converted,t:k.total_time,l:(new Date).getTime()},{path:"/",expires:99999}),window._emv))try{delete window.ldbck_loaded}catch(e){}},k.campaignLoaded=function(e){if(k.log("compaignLoaded",k.W),"block"==k.W.widget_key)return k.W.block_desc&&console.log("Widget is blocked. Reason: "+k.W.block_desc),!1;if("0"==k.W.status)return k.log("Widget is turn off!");if(!k.W.active&&!k.W.night_mode&&!k.is_vk)return k.log("Not active!");if(!k.storage.localStorage.isEmpty("url_config")){var t=k.storage.localStorage.get("url_config"),o=document.location.href;try{o=decodeURIComponent(document.location.href)}catch(e){k.log(e)}for(var i,n="allow"!=t.rule,a=0,l=t.urls.length;a<l;a++){i=(i=t.urls[a]).replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&").replace(/([*])/g,".+"),0!==t.urls[a].indexOf("http:")&&0!==t.urls[a].indexOf("https:")||-1!==t.urls[a].indexOf("*")||(k.log("full url pattern: "+i),i="^"+i+"$");var r=new RegExp(i);if(k.log("CHECK pattern["+t.rule+"]:"+i),r.test(void 0)||r.test(o)){if("allow"==t.rule){k.log("ALLOWED: "+i),n=!0;break}if("deny"==t.rule){k.log("DENIED: "+i),n=!1;break}}}if(!1===n)return k.log("Not allowed by url config")}var s,c;k.W.callback_time&&(k.timer=1e3*k.W.callback_time),s=k.getCookie(k.cg).converted,c=k.W.allow_multiple_conversions,k.is_vk?k.insertWidget(k.W,!0):("1"==k.W.chat&&k.W.chat_id&&k.W.chat_uid&&"undefined"==typeof Cloudim&&(k.log("Chat IS ON",k.W.chat_id),k.loadScript(k.CHAT_CDN+"chat.js?v2.2",!0,function(){k.log("Chat IS loaded"),Cloudim.Options.Chat.silent=!0,k.DEBUG&&(Cloudim.Options.debug=!0);var e,t="rand";k.storage.localStorage.isEmpty("chat_settings")||void 0!==(e=k.storage.localStorage.get("chat_settings")).operators_queue&&(t=e.operators_queue),"all"!=t&&4543!=k.W.user_id||(k.ACCEPT_CHATS=!0,Cloudim.Options.accept_chats=!0),Cloudim.Api.bind("onInit",function(e){k.log("Chat EVENT onInit");var i=!1;"#demomode"==window.location.hash&&(k.log("Demo CHAT mode ON"),window.location.hash="#demomode-chat",Cloudim.Api.clearCache(),i=!0),k.Chat.widget_key||k.loadScript(k.JS_CDN+"leadback-chat-api.js?v="+k.version,!0,function(){k.log("LOADED leadback-chat-api.js",k.version);var o=setInterval(function(){var e,t;!0===k.dom_is_ready?(clearInterval(o),k.Chat=_LBCHATAPI.init(k,k.W),k.Events._callEvent("onChatReady",k.Chat.Api),i?(k.log("CHAT IS Clear"),k.Chat.removeAllChatState(),window.location.reload()):(e=[],k.storage.localStorage.isEmpty("user_info")||(t=k.storage.localStorage.get("user_info"),e.push({name:"fullName",value:t.name}),e.push({name:"Email",value:t.email}),e.push({name:"Phone",value:t.phone})),0<e.length&&Cloudim.Api.sendUserData(e))):k.log("wait_insert_widget...")},100)})}),Cloudim.Api.bind("onReady",function(){k.log("Chat EVENT onReady"),Cloudim.Api.bind("onOperatorChange",function(e){k.DEBUG&&alert("operatorChanged"),e.operator&&k.Chat.acceptChat(e.operator)}),Cloudim.Api.bind("onExternalEvent",function(e){k.log("Chat EVENT onExternalEvent"),"xmpp.operator.cobrowse.internal.page"==e.event&&k.coBrowseV2()}),k.$("#cloudim_chat").hide();var e=setInterval(function(){k.Chat.widget_key&&(clearInterval(e),k.$(window).bind("hashchange",function(){"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done",null!==k.Chat.is_online&&(k.Chat.openChat(),k.Chat.scrollChatsToBottom(!0)))}),Cloudim.Api.getCurrentOperator(function(e){if(k.log("check Offline mode",e),k.ACCEPT_CHATS&&1<e.length&&k.Chat.setAcceptChatMode(e),!1===e){if(k.log("Chat EVENT Offline"),!k.Chat.getChatSettings("offline_invite"))return void k.log("Chat offline_invite IS OFF");if(!1===k.Chat.is_online)return void k.log("Chat now in offline -> exit");k.Chat.setOfflineMode();var t,o=k.storage.localStorage.get("chat_operators"),i=Math.round(Math.random()*(o.length-1));k.storage.localStorage.isEmpty("chat_operator")?k.storage.localStorage.set("chat_operator",i):0<=(t=k.storage.localStorage.get("chat_operator"))&&t<o.length&&(i=t);e=o[i];k.Chat.setOperator(e.operator_name,e.avatar_url),k.Chat.clearChatHistroy();var n=k.Chat.getChatInviteState(),a=k.Chat.getChatSettings("offline_invite_goal"),l=[];l[0]=k.Chat.getChatSettings("offline_invite_greeting"),void 0===a||"bot"==a?(l[1]=k.Chat.getChatSettings("offline_invite_offer"),l[2]=k.Chat.getChatSettings("offline_invite_action"),k.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").show()):(l[1]=k.Chat.getChatSettings("offline_invite_offer_2"),l[2]=k.Chat.getChatSettings("offline_invite_action_2"),k.$("#lb_widget-root .lb-widget-layout-balloon .lb-balloon .lb-balloon__wrapper-form.js-trigger-chat").hide());var r,s=[];if(s[0]=k.Chat.getChatSettings("offline_invite_call_offer"),s[1]=k.Chat.getChatSettings("offline_invite_call_action"),n.called||n.converted){if(k.log("converted & called"),void 0===a||"bot"==a){k.Chat.toggleOperatorButton(),k.Chat.inviteVisitorInChat(l,!0,!0);var c=k.Chat.readLocalMessages();if(c&&c.length)for(var d=0,u=c.length;d<u;d++)k.Chat.addMessageInChat(c[d],"visitor",new Date,!0);k.Chat.inviteVisitorInCall(s,!0)}}else n.readed||n.invited?(k.log("invited & readed"),k.Chat.removeLocalMessages(),k.Chat.toggleOperatorButton(),k.Chat.inviteVisitorInChat(l,!0,n.readed)):(k.log("NOT invited"),k.Chat.removeLocalMessages(),r=k.Chat.getChatSettings("offline_invite_delay"),k.log("getChatSettings -> offline_invite_delay",r),setTimeout(function(){k.log("RUN OFFLINE INVITE"),k.Chat.toggleOperatorButton(),k.Chat.inviteVisitorInChat(l),k.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*r))}else k.Chat.showChatButton()}))},100)}),Cloudim.Api.bind("onShowTab",function(e){k.log("Chat EVENT onShowTab")}),Cloudim.Api.bind("onClose",function(){k.log("Chat EVENT onClose")}),Cloudim.Api.bind("onOpen",function(){k.log("Chat EVENT onOpen")}),Cloudim.Api.bind("onMessage",function(e){var t;k.log("Chat EVENT onMessage"),clearTimeout(k.Chat.operator_answer_timeout),clearTimeout(k.Chat.operator_wait_timeout),k.Chat.stopAnswerSimulation(),k.Chat.addMessageInChat(e.message,"operator",null,null,e.silent),void 0!==e.data&&"string"==typeof e.data.cobrowsing&&k.Chat.startCoBrowsing(e.data.cobrowsing,"Оператор",e.message),k.Chat.clearFaqMessages(),k.Chat.saveIsLiveChat(),k.Chat.chatIsOpen()||(k.Chat.addOperatorMessageInBaloon(e.message,!k.Chat.isLayoutBalloonVisible()),k.Chat.isLayoutBalloonVisible()||k.Chat.showLayoutBalloon(!1),k.Chat.increaseBadge(),t=k.Chat.getChatState(),k.Chat.saveChatState(t.open,+t.unread+1))}),Cloudim.Api.bind("onClientMessage",function(e){k.log("Chat EVENT onClientMessage"),k.Chat.addMessageInChat(e.message,"visitor",null,null,!0)}),Cloudim.Api.bind("onTyping",function(e){k.log("Chat EVENT onTyping"),clearTimeout(k.Chat.operator_answer_timeout),clearTimeout(k.Chat.operator_wait_timeout),!0===e.typing?k.Chat.operatorWriting():!1===e.typing&&k.Chat.operatorNotWriting()}),Cloudim.Api.bind("onOnline",function(){k.log("Chat EVENT onOnline");var e=setInterval(function(){if(k.Chat.widget_key){if(clearInterval(e),null!==k.Chat.initial_status)return void k.log("IGNORE Chat EVENT onOnline");k.Chat.showChatButton(),Cloudim.Api.getVisitor(function(e){e.chatted&&k.Chat.toggleOperatorButton();var t=k.Chat.getChatState();if(0<t.unread)for(var o=0;o<t.unread;o++)k.Chat.increaseBadge();k.Chat.clearChatHistroy(),k.Chat.loadHistory(e.history),e.jid&&k.Chat.setVisitorJid(e.jid),(t.open&&!k.isMobile()||"#chatopen"==window.location.hash)&&(k.Chat.openChat(),k.Chat.scrollChatsToBottom(!0),"#chatopen"==window.location.hash&&(window.location.hash="#chatopen-done"))}),Cloudim.Api.getCurrentOperator(function(e){var t,o,i,n,a,l,r;k.log("getCurrentOperator",e),k.ACCEPT_CHATS&&1<e.length&&k.Chat.setAcceptChatMode(e),e?(k.Chat.setOnlineMode(),t=k.Chat.getChatInviteState(),k.log("invite_state",t),o=k.Chat.getChatSettings("chat_invite"),k.log("getChatSettings -> chat_invite",o),i=k.Chat.isChattedVisit(),k.log("isChattedVisit -> is_chatted_visit",i),k.Chat.initFaq(),o&&!i&&((n=[])[0]=k.Chat.getChatSettings("chat_invite_greeting"),n[1]=k.Chat.getChatSettings("chat_invite_offer"),n[2]=k.Chat.getChatSettings("chat_invite_action"),k.log("getChatSettings -> invite messages",n),t.invited?t.invited&&!t.readed?(k.Chat.toggleOperatorButton(),k.Chat.inviteVisitorInChat(n,!0)):t.invited&&t.readed&&!t.converted&&(k.Chat.toggleOperatorButton(),k.Chat.inviteVisitorInChat(n,!0,!0)):(a=k.Chat.getChatSettings("invite_delay"),k.log("getChatSettings -> invite_delay",a),clearTimeout(k.Chat.invite_timeout),k.Chat.invite_timeout=setTimeout(function(){k.log("RUN INVITE"),k.Chat.toggleOperatorButton(),k.Chat.inviteVisitorInChat(n),k.Chat.saveChatInviteState(!0,!1,!1,!1)},1e3*a))),l=k.storage.localStorage.get("chat_operators"),(r=k.Chat.getCurrentOperator(e,l))?k.Chat.setOperator(r.operator_name,r.avatar_url):0<l.length&&0<e.length&&(l=k.Chat.getOnlineWidgetOperators(l,e)).length?k.Chat.setOperator(l[0].operator_name,l[0].avatar_url):k.Chat.setOperator("Оператор","/images/portraits/2.jpg")):k.log("Chat EVENT Offline")}),k.Chat.Events._callEvent("onOnline")}},100)}),k.DEBUG?(k.log("Chat DEBUG is ON"),Cloudim.Chat.init({uid:20621})):Cloudim.Chat.init({uid:k.W.chat_uid,group:k.W.chat_id})})),k.loadScript(k.JS_CDN+"_assets.min.js?v="+k.version,!0,function(){if(k.W.float_button&&k.log("float_button IS ON"),k.isMobile())k.W.mobile_button?k.insertWidget(k.W):k.log("mobile_button IS OFF");else if(k.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(k.insertWidget(k.W,!0),window.location.hash="#callback-showed")}),"#leadback"==window.location.hash)setTimeout(function(){k.insertWidget(k.W,!0)},3e3);else if(!s||c||k.W.float_button){if(void 0===k.getCookie(k.ct)||k.W.float_button)return k.insertWidget(e);ldbck.log("Campaign Timeout Period")}else k.log("Already Converted!")})),k.sendEvent("pageview")},k.insertWidget=function(e,v){if(!0===k.dom_is_ready)return k.log("Widget has be inserted"),void(v&&k.showWidget(k.$("#lb_widget-root")));k.log("insertWidget");var t,o,i=window.location.host,n=encodeURI(k.PUBLIC_SERVER+"backend/widget_widget.php?h="+i+"&widget_key="+k.W.widget_key+"&v="+k.version);k.is_vk?k.DEBUG||(n+="&vk_api="+encodeURIComponent(document.location.href)):k.isMobile()?(n+="&mobile",n+="&chat="+k.W.chat):(n+="&chat="+k.W.chat,k.log("self.W.chat_init",k.W.chat_init),"1"==k.W.chat&&k.W.chat_init&&(n+="&chat_init="+k.W.chat_init)),k.log("url",n),k.$.ajax({type:"GET",async:!0,cache:!0,url:n,error:function(e,t,o){return k.log(o),k.log("Main HTML Failed to Load")},success:function(e){var t="";t=""==k.W.position?(0,"bottom: 50px; right: 50px"):k.W.position;var n=k.$("<div id='lb_widget-root'><div id='lb_widget-wrapper' style='display:none;'></div><div id='lb_eula_widget-wrapper' style='display:none;'></div><div id='lb_button-wrapper' style='position: fixed; "+t+" ; z-index: 10000000000;'></div></div>");if(n.find("#lb_widget-wrapper").html(e.html).hide(),n.find("#lb_eula_widget-wrapper").html(e.eula).hide(),n.find("#lb_widget-wrapper .lb_callback_time").text(k.W.callback_time?k.W.callback_time:27),!k.storage.localStorage.isEmpty("scheduler")&&(!k.W.active&&k.W.night_mode&&(void 0===k.W.suitable_time||"nigth"==k.W.suitable_time)||void 0!==k.W.suitable_time&&"always"==k.W.suitable_time)){var a=k.storage.localStorage.get("scheduler");if("object"==typeof a&&0<a.days.length){n.on("click","#lb_widget-scheduler--link",function(e){e.preventDefault(),n.find("#lb_widget-scheduler").show(),n.find("#lb_widget-invite").hide(),n.find("#lb_timer").hide(),n.find("#lb_widget-scheduler--controls").hide(),n.find("#lb_widget-scheduler").data("opened",!0)}),n.on("change","#lb_widget-scheduler--days",function(e){var t=k.$("option:selected",this).data();if(null!==t){n.find("#lb_widget-scheduler--times").empty();for(var o=0,i=a.times[t.index].length;o<i;o++)n.find("#lb_widget-scheduler--times").append('<option value="'+k.escapeHtml(a.times[t.index][o].value)+'">'+k.escapeHtml(a.times[t.index][o].label)+"</option>")}});for(var o=0,i=a.days.length;o<i;o++)n.find("#lb_widget-scheduler--days").append('<option value="'+k.escapeHtml(a.days[o].value)+'" data-index="'+o+'">'+k.escapeHtml(a.days[o].label)+"</option>");n.find("#lb_widget-scheduler--days").trigger("change"),n.find("#lb_widget-scheduler--controls").show()}}if(!k.storage.localStorage.isEmpty("departments"))for(var l=k.storage.localStorage.get("departments"),o=0,i=l.length;o<i;o++)n.find("#lb_widget-department--items").append('<label class="lb_widget-radio"><input type="radio" name="lb_widget-department--value" data-index="'+o+'" value="'+k.escapeHtml(l[o])+'" '+(0==o?'checked="checked"':"")+"/>&nbsp;"+k.escapeHtml(l[o])+"</label>");if(k.isMobile()){k.$multibutton=n.find("ldiv.lb-widget"),k.is_multibutton=!!k.$multibutton.length,n.find("#lb_exit").on("click",function(){k.hideWidget(n)});var r,s,c=n.find("#lb_mobile-call"),d=n.find(".lb_mobile-wrapper");if(k.$("body").on("click",'a[href="#callback"]',function(e){k.showWidget(n),e.preventDefault()}),k.$("body").on("click","#lb_widget-root a.js-trigger-callback",function(e){k.showWidget(n),e.preventDefault()}),k.$(window).on("hashchange",function(){"#callback"==window.location.hash&&(k.showWidget(n),window.location.hash="#callback-showed")}),"1"==k.W.chat){try{k.$(window).on("ready",function(){var e=k.screen_width/window.innerWidth;n.find(".lb-widget-button").css("zoom",1/e),n.find(".lb-widget-welcome-panel").css("zoom",1/e)})}catch(e){}c.on("click",function(){k.showWidget(n)})}else{k.$(window).on("orientationchange load",function(){90==window.orientation||-90==window.orientation?(k.screen_width=Math.max(window.screen.availWidth,window.screen.availHeight),k.screen_height=Math.min(window.screen.availWidth,window.screen.availHeight)):(k.screen_width=Math.min(window.screen.availWidth,window.screen.availHeight),k.screen_height=Math.max(window.screen.availWidth,window.screen.availHeight)),k.mobileButton(c,d)}),k.$(window).on("touchmove",function(){k.mobileButton(c,d)}),k.$(window).on("touchstart",function(){c.css("opacity",0)}),k.$(window).on("touchend",function(){c.css("opacity",1),k.mobileButton(c,d)}),k.$(window).on("scroll",function(){c.css("opacity",0),clearTimeout(r),r=setTimeout(function(){c.css("opacity",1),k.mobileButton(c,d)},300)}),k.mobileButton(c,d),k.is_multibutton?(n.on("click","#lb_widget-wrapper .lb-widget-button",function(e){k.$multibutton.toggleClass("lb-widget--open-dialog")}),n.on("click","#lb_widget-wrapper .lb-action-link--discard",function(e){e.preventDefault(),k.$multibutton.toggleClass("lb-widget--open-dialog")}),n.on("click","#lb_widget-wrapper .lb-widget > .lb-overlay",function(e){e.preventDefault(),k.$multibutton.toggleClass("lb-widget--open-dialog")}),k.startMultiButtonSlides()):c.find(".lb-click_area").on("click",function(){k.showWidget(n)})}d.find("input.lb_input").on("focus",function(){d.find(".lb_title-desc").hide(),d.find(".lb_form-label").show()}),!k.is_multibutton||(s=n.find("#lb-multibutton-style-os")).length&&(k.isIOS()?s.attr("href",k.PUBLIC_SERVER+"/css/multibutton/style-ios.min.css?"+k.version):s.attr("href",k.PUBLIC_SERVER+"/css/multibutton/style-android.min.css?"+k.version),s.on("load",function(){setTimeout(function(){k.$multibutton.show(),k.$multibutton.find(".lb-overlay").attr("style",""),k.$multibutton.find(".lb-dialog").attr("style","")},50)}))}else{if(k.$('a[href="#callback"]').on("click",function(e){k.showWidget(n),e.preventDefault()}),k.W.float_button&&e.button){n.find("#lb_button-wrapper").html(e.button),"1"==k.W.chat&&n.find(".phone-call_wave").removeClass("phone-call_wave__stroke");var u=n.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(),u=k.parseMacros(u);if(u=k.parseInlineTemplates(u),u=k.parseCountDownMacros(u),n.find(".lb_button_tooltip--container .lb_button_tooltip--text").html(u),n.find("#lb_button-call").hasClass("lb_fixed-button"))n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){k.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),k.storage.localStorage.set("tooltip_closed",!0))});else if("0"!=k.W.chat||k.isTouch())n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){k.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),k.storage.localStorage.set("tooltip_closed",!0))});else{n.find("#lb_button-wrapper").attr("title","Нажмите, чтобы заказать обратный звонок или перетащите, если кнопка мешает навигации.");try{k.$(n.find("#lb_button-call")[0]).draggableTouch().on("dragstart",function(e,t){this.ignoreClick=!1,t&&(this.startPosition=t)}).on("dragend",function(e,t){t&&(this.startPosition.top-t.top==0||this.startPosition.left-t.left==0||(this.ignoreClick=!0))}),n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){n.find("#lb_button-call")[0].ignoreClick||(k.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),k.storage.localStorage.set("tooltip_closed",!0)))})}catch(e){n.find("#lb_button-call .lb_call-btn, #lb_button-call .lb_button_tooltip").on("click",function(){k.showWidget(n),n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--show")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--show").addClass("lb_button_tooltip--hide"),k.storage.localStorage.set("tooltip_closed",!0))})}}var g,h=null,p=null,_=(k.$(document).innerHeight()-k.$(window).height())/k.$(window).height();"0"==k.W.chat&&.5<_?(n.find("#lb_button-wrapper").show(),n.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),k.$(document).on("scroll",function(){if(k.widgetIsShow(n))return!0;var e=k.$(document).scrollTop()/(k.$(document).innerHeight()-k.$(window).height());n.find("#lb_button-wrapper .lb_call-btn").css("opacity",1),clearInterval(h),h=setInterval(function(){e<=.3&&n.find("#lb_button-wrapper .lb_call-btn").css("opacity",.7),clearInterval(h)},500),(150<k.$(document).scrollTop()||.3<e)&&(clearInterval(p),n.find("#lb_button-wrapper").show(),n.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),300<k.$(document).scrollTop()&&.4<e&&n.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"))})):(n.find("#lb_button-wrapper").show(),n.find("#lb_button-wrapper .lb_call-btn").addClass("bigEntrance"),"0"==k.W.chat?n.find("#lb_button-wrapper .lb_call-btn").addClass("lb-pulse"):n.find("#lb_button-wrapper .lb_call-btn").css("opacity",1)),k.W.tooltip_scroll&&(g=null,k.$(document).on("scroll",function(){clearInterval(g),.5<=k.$(document).scrollTop()/(k.$(document).innerHeight()-k.$(window).height())&&(g=setTimeout(function(){k.storage.localStorage.isEmpty("tooltip_closed")||!1===k.storage.localStorage.get("tooltip_closed")?void 0===n.find("#lb_button-call:hover")[0]&&n.find("#lb_button-wrapper .lb_button_tooltip").hasClass("lb_button_tooltip--hide")&&(n.find("#lb_button-wrapper .lb_button_tooltip").removeClass("lb_button_tooltip--hide").addClass("lb_button_tooltip--show"),setTimeout(function(){n.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--alert")},3e3)):k.log("tooltip_closed"),clearTimeout(g)},500))})),k.W.tooltip_hover&&n.find("#lb_button-wrapper .lb_button_tooltip").addClass("lb_button_tooltip--hover"),n.find("#lb_button-wrapper .lb_button_tooltip .lb_button_tooltip--close").on("click",function(e){n.find("#lb_button-wrapper .lb_button_tooltip--container").remove(),k.storage.localStorage.set("tooltip_closed",!0)})}n.find("#lb_exit").on("click",function(){k.hideWidget(n)})}n.on("click",".lb_eula--link",function(e){e.preventDefault(),e.stopPropagation(),k.showEula(k.$(this).attr("href"))}),n.on("click","#lb_eula_widget-wrapper",function(){k.hideEula()});var f=k.getPhonePrefix();n.on("focus","#lb_phone",function(){var e=k.$(this);""==e.val()&&e.val(f),e.val()==f&&setTimeout(function(){e.get(0).selectionStart=e.get(0).selectionEnd=100},10)}).on("change","#lb_phone",function(){var e=k.$(this).val().replace(/[^\d\+]+/g,"");k.$(this).val(e),!1!==(e=k.checkPhone(e))&&k.$(this).val(e)}).on("keypress","#lb_phone",function(e){13==e.which&&(n.find("#lb_send").trigger("click"),e.preventDefault())}).on("paste","#lb_phone",function(e){return e.preventDefault(),!1}).on("drop","#lb_phone",function(e){return e.preventDefault(),!1}).attr("placeholder",f),n.on("click","#lb_send",function(){if(!k.storage.localStorage.isEmpty("departments")){var e=n.find("#lb_phone").val();if(!1===(e=k.checkPhone(e)))return void n.find("#lb_phone").addClass("lb_error");n.find("#lb_phone").removeClass("lb_error"),n.find("#lb_widget-invite").hide(),n.find("#lb_widget-scheduler").hide(),n.find("#lb_widget-form").hide(),n.find("#lb_widget-scheduler--controls").hide(),n.find("#lb_widget-department").show(),n.find("#lb_send--department").on("click",function(){k.callTo(n)})}else k.callTo(n)}),!k.W.active&&k.W.night_mode&&(n.find("#lb_timer").hide(),n.find(".lb_h6").css("visibility","hidden")),k.$("body").append(n),k.isMobile()&&n.find("#lb_widget-wrapper").show(),k.dom_is_ready=!0;var m,b,w=k.getCookie("__leadback_need_call");w?(k.removeCookie("__leadback_need_call",{path:"/"}),k.$("#lb_phone").val(w.phone),void 0!==k.W.magic_forms_callback&&"show"==k.W.magic_forms_callback&&k.showWidget(n),m={initiator:"magic_forms"},void 0!==w.label&&(m.label=w.label),k.callTo(n,m)):(v?k.showWidget(n):void 0!==k.W.catch_on_exit&&!k.W.catch_on_exit||k.startCursometer(n),void 0!==k.W.catch_by_timer&&k.W.catch_by_timer&&(b=1e3*k.W.catch_by_timer_time,void 0===k.getCookie(k.ct)?setTimeout(function(){k.log("Time show after: "+b),k.showWidget(n),k.setCookie(k.ct,{campaign:k.W.widget_key,user_id:k.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*k.W.timeout)})},b):k.log("Time show timeout"))),"function"==typeof window.muse_init&&k.$("body").addClass("initialized")},dataType:"jsonp",jsonpCallback:"jsonpWidgetCallback"}),void 0!==k.W.magic_forms&&(t=!1,!k.W.active&&k.W.night_mode&&"off"===k.W.magic_forms_night_mode&&(t=!0),"none"!=k.W.magic_forms&&!1===t&&(o="","custom"==k.W.magic_forms&&(o=".lb-magic-form"),k.$("form"+o).on("submit",function(e){var l=[];k.$("input",this).each(function(e,t){var o=0,i=null,n=null;if(void 0!==k.$(t).attr("type")){if(n=k.$(t).attr("type"),-1===["tel","text"].indexOf(n))return;"tel"==n&&(o+=50)}void 0!==k.$(t).attr("name")&&(i=k.$(t).attr("name"),-1!==["phone","number","callback","tel","telephone"].indexOf(i)&&(o+=50));var a=k.checkPhone(t.value);!1!==a&&(l[l.length]={value:a,priority:o,field:i,type:n})});var t,o=null;if(0<l.length)for(var i=0,n=l.length;i<n;i++)(null===o||l[i].priority>o.priority)&&(o=l[i]);o&&(t=k.$(this).data("magic-form-label"),k.setCookie("__leadback_need_call",{phone:o.value,field:o.field,type:o.type,label:t},{path:"/",expires:new Date((new Date).getTime()+6e4)}))})))},k.checkPhone=function(e){return"9"==(e=e.replace(/[^\d]+/g,"")).substr(0,1)&&10==e.length&&(e="7"+e),"495"!=e.substr(0,3)&&"499"!=e.substr(0,3)&&"812"!=e.substr(0,3)&&"4832"!=e.substr(0,4)||10!=e.length||(e="7"+e),"8"==e.substr(0,1)&&11==e.length&&(e="7"+e.substr(1)),"789"==e.substr(0,3)&&12==e.length&&(e="7"+e.substr(2)),("7"!=e.substr(0,1)||11==e.length)&&((11==e.length||12==e.length)&&(e="+"+e))},k.startCursometer=function(o){k.restarted||k.isMobile()?k.log("IGNORE startCursometer"):(k.log("startCursometer"),k.$(window).cursometer({onUpdateSpeed:function(e,t){if(null!==e)return k.LAST_SPEED=t},updateSpeedRate:15}),k.$("html").mouseout(function(e){var t;e=e||window.event,k.LAST_X_POSITION=e.clientX,k.LAST_Y_POSITION=e.clientY,0<k.LAST_Y_POSITION||k.LAST_X_POSITION<200||(k.total_time>=k.activity?(t=void 0===k.getCookie(k.cg)||!k.getCookie(k.cg).converted||k.W.allow_multiple_conversions,.225<k.LAST_SPEED&&t&&void 0===k.getCookie(k.ct)&&k.last_visit_timeout<300?(k.stat.x=k.LAST_X_POSITION,k.stat.y=k.LAST_Y_POSITION,k.stat.s=k.LAST_SPEED,k.showWidget(o),k.setCookie(k.ct,{campaign:k.W.widget_key,user_id:k.W.user_id},{path:"/",expires:new Date((new Date).getTime()+6e4*k.W.timeout)}),k.log("Set timeout "+k.W.timeout)):k.log("Impression timeout",k.last_visit_timeout,void 0===k.getCookie(k.ct))):k.log("activity",k.activity,k.total_time,k.last_visit_timeout))}))},k.showWidget=function(e){k.log("showWidget"),k.widgetIsShow(e)?k.log("IS now shoed"):(k.parseWidgetText(e),"function"==typeof k.beforeOpenWidget&&k.beforeOpenWidget(),k.sendEvent("impression"),k.sendGoal("LEADBACK_OPEN"),e.show(),k.isMobile()?(e.find(".lb_mobile-wrapper").show(),k.mobileAdoptation()):(e.find("#lb_widget-wrapper").show(),e.find("#lb_phone").focus()),k.W.float_button&&e.find("#lb_button-wrapper").hide()),void 0!==k.W.hide_call_timer&&k.W.hide_call_timer&&e.find("#lb_timer").hide()},k.hideWidget=function(e){e.find("#lb_widget-scheduler").is(":visible")&&(e.find("#lb_widget-scheduler").hide(),e.find("#lb_widget-scheduler").data("opened",!1),e.find("#lb_widget-invite").show(),k.W.active&&e.find("#lb_timer").show(),e.find("#lb_widget-scheduler--controls").show()),k.isMobile()?(k.sendGoal("LEADBACK_CLOSE"),e.find(".lb_mobile-wrapper").hide(),k.mobileAdoptation()):(k.sendGoal("LEADBACK_CLOSE"),e.find("#lb_widget-wrapper").hide(),k.W.float_button&&e.find("#lb_button-wrapper").show())},k.startMultiButtonSlides=function(){return!!k.is_multibutton&&setInterval(function(){var o,i,e;k.dom_is_ready&&(o=null,k.$("#lb_widget-root .lb-button__slides .lb-button-slides__item").each(function(e,t){k.$(t).hasClass("lb-button-slides__item--active")?(o=e,k.$(t).removeClass("lb-button-slides__item--active"),(i=k.$(t).data("slide-action"))&&k.$(t).closest(".lb-button-flipper__front").removeClass("lb-button-flipper__front--"+i)):null!==o&&(k.$(t).addClass("lb-button-slides__item--active"),o=null,(i=k.$(t).data("slide-action"))&&k.$(t).closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i))}),null!==o&&((e=k.$("#lb_widget-root .lb-button__slides .lb-button-slides__item:first-child")).addClass("lb-button-slides__item--active"),(i=e.data("slide-action"))&&e.closest(".lb-button-flipper__front").addClass("lb-button-flipper__front--"+i)))},1e4)},k.getUrlParameter=function(e){var t=location.search;e=e.replace(/[\-\[\]{}()+!<=:?\.\,\/\\\^$|#\s]/g,"\\$&");var o=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t),i="";return o&&0<o.length&&(i=o[1].replace(/\+/g," "),i=decodeURIComponent(i),i=(i=k.escapeHtml(i)).replace(/\_/g," ")),null===o?"":i},k.checkCanReplaceMacro=function(e){if("string"!=typeof e)return!1;for(var t=["/images/uploads/chat","https://leadback.ru/ya-money?payment=","https://leadback.ru/chat-payments?payment=","s3upload://","https://leadback.s3.eu-central-1.amazonaws.com/chat_uploads/","https://leadback.s3.eu-central-1.amazonaws.com/uploads/"],o=0;o<t.length;o++)if(0===e.indexOf(t[o]))return!1;return!0},k.parseQueryMacros=function(e){if(!k.checkCanReplaceMacro(e))return e;var t,o=e.match(/\[get\:([^\]\|]+)\|?([^\]\|]+)?\]/gm);if(null!==o&&o.length)for(var i=0,n=o.length;i<n;i++){var a,l=o[i].replace(/^\[/,"").replace(/\]$/,"");e=-1<(a=(l=l.substr(l.indexOf(":")+1)).lastIndexOf("|"))?""!==(t=k.getUrlParameter(l.substr(0,a)))?e.replace(o[i],t):e.replace(o[i],l.substr(a+1)):(t=k.getUrlParameter(l),e.replace(o[i],t))}return e},k.parseTimeMacros=function(e){if(!k.checkCanReplaceMacro(e))return e;var t,o=[],i=e.match(/\[(time)(\+|\-)?(\d+)?\]/gim);null!==i&&(o=i);for(var n=0,a=o.length;n<a;n++){var l=new Date,r=o[n].replace(/[\[\]]/g,"");e=(-1<r.indexOf("-")?(t=Number(r.split("-")[1]),l.setMinutes(l.getMinutes()-t)):-1<r.indexOf("+")&&(t=Number(r.split("+")[1]),l.setMinutes(l.getMinutes()+t)),e.replace(o[n],l.toLocaleTimeString().substr(0,l.toLocaleTimeString().lastIndexOf(":"))))}return e},k.parseMacros=function(e){return k.checkCanReplaceMacro(e)?(e=k.parseTimeMacros(e),e=k.parseQueryMacros(e)):e},k.parseCountDownMacros=function(e){if(!k.checkCanReplaceMacro(e))return e;for(var t,o=/\[countdown\|([^\]\|]+)\|?([^\]\|]+)?\|?([^\]\|]+)?\|?([^\]\|]+)?]/gi,i=null;null!==(t=o.exec(e));)i=!0,e=e.replace(t[0],'<span class="lbwidget-countdown" data-date="'+t[1]+'" data-tpl="'+(t[2]?t[2]:"")+'" data-expire="'+(t[3]?t[3]:"")+'" data-format="'+(t[4]?t[4]:"")+'">'+k.prepareCountDownText(t[1],t[2]?t[2]:null,t[3]?t[3]:null,t[4]?t[4]:null)+"</span>");if(!i)return e;try{clearInterval(k.countDownInterval)}catch(e){}return k.setCountDownText(),k.countDownInterval=setInterval(function(){k.setCountDownText()},1e3),e},k.countdownTimeDeclensions={hour:["час","часа","часов"],minute:["минута","минуты","минут"],second:["секунда","секунды","секунд"]},k.declension=function(e,t,o,i,n){t=null==t?"":t,o=null==o?"я":o,i=null==i?"и":i,n=null==n?"й":n;var a=(e=null==e?0:e)%100,l="";if(10<=e&&e<=20||10<=a&&a<=20)l=n;else switch(e%10){case 1:l=o;break;case 2:case 3:case 4:l=i;break;default:l=n}return t+l},k.prepareCountDownText=function(e,t,o,i){var n=Date.parse(e);if(isNaN(n)||!n)return"";4!==(i=(i=i||"дн. ,:,:,").split(",")).length&&(i="дн. ,:,:,".split(","));var a,l,r,s,c,d,u,g,h,p,_,f,m,b,w,v,C=n-(new Date).getTime(),y="";return 0<=C?(a=Math.floor(C/864e5),l=Math.floor(C%864e5/36e5),r=Math.floor(C%36e5/6e4),s=Math.floor(C%6e4/1e3),u=0<a?a+i[0]:"",h=(g=i[1]).replace(/[^а-яё]/gi,""),h=k.$.trim(h.toLowerCase()),-1<(p=k.countdownTimeDeclensions.hour.indexOf(h))&&(g=g.replace(k.countdownTimeDeclensions.hour[p],k.declension(l,"час","","а","ов"))),c=l<10?"0"+l.toString()+g:l.toString()+g,f=(_=i[2]).replace(/[^а-яё]/gi,""),f=k.$.trim(f.toLowerCase()),-1<(m=k.countdownTimeDeclensions.minute.indexOf(f))&&(_=_.replace(k.countdownTimeDeclensions.minute[m],k.declension(r,"минут","а","ы",""))),d=r<10?"0"+r.toString()+_:r.toString()+_,w=(b=i[3]).replace(/[^а-яё]/gi,""),w=k.$.trim(w.toLowerCase()),-1<(v=k.countdownTimeDeclensions.second.indexOf(w))&&(b=b.replace(k.countdownTimeDeclensions.second[v],k.declension(s,"секунд","а","ы",""))),y=u+c+d+(s<10?"0"+s.toString()+b:s.toString()+b),t&&(-1===t.indexOf("%s")&&(t+=" %s"),y=t.replace("%s",y))):o&&(y=o),y},k.setCountDownText=function(){var e=k.$("span.lbwidget-countdown");if(0===e.length)return clearInterval(k.countDownInterval),!1;for(var t=0;t<e.length;t++){var o=k.$(e[t]),i=""!==o.data("tpl")?o.data("tpl"):null,n=""!==o.data("expire")?o.data("expire"):null,a=""!==o.data("format")?o.data("format"):null,l=k.prepareCountDownText(o.data("date"),i,n,a);o.html(l)}},k.parseWidgetText=function(e){for(var t=e.find(".lb-parse-text"),o=0;o<t.length;o++){var i=k.$(t[o]),n=i.html();"string"==typeof n&&(i.hasClass("lb-parse-inline")&&(n=k.parseInlineTemplates(n)),n=k.parseMacros(n),n=k.parseCountDownMacros(n),i.html(n))}},k.getReplacedTags=function(){return k.replacedTags},k.parseInlineTemplates=function(e){if(!k.checkCanReplaceMacro(e))return e;var t=[],o=e.match(/\[\#([^\#\|\]]+)\]/gm);null!==o&&(t=o),null!==(o=e.match(/\[\#([^\#\|\]]+)\|([^\]]+)\]/gm))&&(t=t.concat(o));for(var i=0,n=t.length;i<n;i++){var a=[],a=0<t[i].indexOf("|")?t[i].replace(/[\[\]]/g,"").split("|"):[t[i].replace(/[\[\]]/g,""),""],l=k.$(a[0]);0<l.length&&""!=k.$.trim(l.text())?(e=e.replace(t[i],l.text()),k.replacedTags[a[0].replace("#","")]=l.text()):(e=e.replace(t[i],a[1]),k.replacedTags[a[0].replace("#","")]=a[1])}return e},k.widgetIsShow=function(e){return k.isMobile()?e.find(".lb_mobile-wrapper").is(":visible"):e.find("#lb_widget-wrapper").is(":visible")},k.showEula=function(e){k.$("#lb_eula_widget-wrapper").show(),k.$("#lb_eula--frame").attr("src",e)},k.hideEula=function(){k.$("#lb_eula_widget-wrapper").hide(),k.isMobile()||k.$("#lb_phone").focus()},k.callTo=function(t,o){k.log("callTo");var e=t.find("#lb_phone").val();if(!1!==(e=k.checkPhone(e))){t.find("#lb_phone").removeClass("lb_error"),k.sendGoal("LEADBACK_CALL",o),void 0!==k.W.hide_call_timer&&k.W.hide_call_timer?t.find(".lb_show_when_calling").hide():(k.startTimer(t),t.find(".lb_show_when_calling").show()),t.find(".lb_hide_when_calling").hide(),t.find("#lb_send").off("click"),t.find("#lb_button_call_success").off("click").on("click",function(){k.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_button_call_success--department").off("click").on("click",function(){k.stopTimer(t),t.find(".lb_hide_when_call_answered").hide(),t.find(".lb_show_when_call_answered").show()}),t.find("#lb_widget-scheduler--controls").hide();var i="";!0===t.find("#lb_widget-scheduler").data("opened")&&(i=t.find("#lb_widget-scheduler--days").val()+" "+t.find("#lb_widget-scheduler--times").val());var n,a,l="",r="",s=!k.storage.localStorage.isEmpty("departments"),c="";return"object"==typeof o&&(void 0!==o.delayed&&(i=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(o.delayed)?o.delayed:(a=["00","0",""],(n=new Date).setSeconds(n.getSeconds()+parseInt(o.delayed,10)),n.getFullYear()+"-"+(a[new String(n.getMonth()+1).length]+new String(n.getMonth()+1))+"-"+(a[new String(n.getDate()).length]+new String(n.getDate()))+" "+(a[new String(n.getHours()).length]+new String(n.getHours()))+":"+(a[new String(n.getMinutes()).length]+new String(n.getMinutes()))+":"+(a[new String(n.getSeconds()).length]+new String(n.getSeconds()))),k.log("SET delayed_time",i)),void 0!==o.label&&(l=o.label),void 0!==o.initiator&&(r=o.initiator),s&&void 0!==o.department&&(c=o.department)),k.log("Department assigned",c),""===c&&s&&(c=t.find('#lb_widget-department--items input[name="lb_widget-department--value"]:checked').val()),k.$.ajax({type:"GET",async:!0,url:k.PUBLIC_SERVER+"backend/widget_call.php",data:{site:window.location.host,phone:e,widget_key:k.W.widget_key,user_id:k.W.user_id,delayed:i,tz:k.getTz(),guid:k.getCookie(k.cg).guid,calltouch:window.calltouch_phone||window.calltouch_phone_1||window.calltouch_phone_2||"",department:c,label:l,initiator:r,cache:Math.random()},success:function(e){return k.setCookie(k.cg,{guid:k.getCookie(k.cg).guid,converted:!0},{path:"/",expires:99999}),"delayed"==e.result?(k.stopTimer(t),t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_delay-date").text(e.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),t.find(".lb_delay-time").text(e.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1")),t.find("#lb_close").on("click",function(){t.hide(),k.isMobile()&&k.mobileAdoptation()})):k.isMobile()&&"success"==e.result?(t.find(".lb_widget-container").hide(),t.find(".lb_widget-message").show(),t.find(".lb_message_title--delayed").hide(),t.find(".lb_message_title--success").show(),t.find("#lb_close").on("click",function(){t.hide(),k.isMobile()&&k.mobileAdoptation()})):"notice"===e.result&&k.showNotice(t,e),void 0===k.W.hide_call_timer||!k.W.hide_call_timer||"success"!==e.result&&"delayed"!==e.result||k.showNotice(t,e),"success"!=e.result&&"delayed"!=e.result&&"notice"!=e.result||"delayed"===e.result&&e.exists||k.sendEvent("call"),"function"==typeof k.successCallCallback&&(e.params=o,k.successCallCallback(e)),void 0!==k.Chat.widget_key&&void 0!==e.data&&void 0!==e.data.callback_phone&&""!=e.data.callback_phone&&k.Chat.sendEvent("set_profile",{profile:{phone:e.data.callback_phone}}),k.log("Call Success")},error:function(){return k.log("Call Error!")},dataType:"jsonp",jsonpCallback:"jsonpCallCallback"})}t.find("#lb_phone").addClass("lb_error")},k.showNotice=function(e,t){e.find(".lb_widget-container").hide(),e.find(".lb_widget-message").show(),t.time&&""!==t.time?(e.find(".lb_delay-date").text(t.time.replace(/^\d{2}(\d{2})\-(\d{2})\-(\d{2}) .+$/,"$3/$2")),e.find(".lb_delay-time").text(t.time.replace(/^.+(\d{2}\:\d{2})\:\d{2}$/,"$1"))):(e.find(".lb_message_title--delayed").hide(),e.find(".lb_message_title--success").show()),e.find("#lb_close").on("click",function(){e.hide(),k.isMobile()&&k.mobileAdoptation()})},k.startTimer=function(t){k.log("startTimer"),k.interval=setInterval(function(){var e=k.timer-46;e<=0&&(e=0,clearInterval(k.interval)),k.timer=e,k.timerHtml(t)},46)},k.stopTimer=function(e){k.log("stopTimer"),clearInterval(k.interval)},k.timerHtml=function(e){var t=0,o=Math.floor(k.timer/1e3).toString(),t=Math.round((k.timer-1e3*o)/10).toString();o=o.length<2?"0"+o:o,t=t.length<2?"0"+t:2<t.length?"00":t,e.find("#lb_timer_result").text("0:"+o+","+t)},k.sendEvent=function(e,t){return k.log("sendEvent",e,t),k.$.ajax({type:"GET",async:!0,url:k.PUBLIC_SERVER+"backend/widget_event.php",data:{type:e,widget_key:k.W.widget_key,user_id:k.W.user_id,guid:k.getCookie(k.cg).guid,ga_cid:k.getGoogleCid(),ya_cid:k.ya_cid,roistat:k.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(){return k.log("Event Stat ["+e+"] Success")},error:function(){return k.log("Event Stat ["+e+"] Error!")},dataType:"jsonp",jsonpCallback:"jsonpEventCallback_"+e})},k.analytics=function(e){return k.log("sendAnalytics",e),k.$.ajax({type:"GET",async:!0,url:k.PUBLIC_SERVER+"backend/widget_analytics.php",data:{data:e,cache:Math.random()},success:function(){},error:function(){},dataType:"jsonp",jsonpCallback:"jsonpAnalyticsCallback"})},k.sendGoal=function(e,t){var o;if(k.log("Call sendGoal"),!1!==k.Events._callEvent("onGoalEvent",{goal:e,params:t})){if(k.log("Send GOAL GA:"+e),"function"==typeof ga&&(ga("send","event",e,"clicked"),ga("ldbckTracker.send","event",e,"clicked")),"function"==typeof gtag&&gtag("event",e,{event_category:e,event_action:"clicked"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:e}),0<k.ya.length)for(var i=k.ya.length-1;0<=i;i--)k.log("Send GOAL YA("+k.ya[i]+"):"+e),window[k.ya[i]].reachGoal(e);"LEADBACK_CALL"==e&&""!=k.W.facebook_pixel_event&&(k.log("track fb event "+k.W.facebook_pixel_event),""!=k.W.facebook_pixel_id?(o='<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id='+encodeURIComponent(k.W.facebook_pixel_id)+"&ev="+encodeURIComponent(k.W.facebook_pixel_event)+'&noscript=1"/>',k.log("nonscript pixel"),k.$("body").append(o)):"function"==typeof fbq?fbq("track",k.W.facebook_pixel_event):k.log("need pixel ID"))}},k.getPhonePrefix=function(){var e={ru:"+7",ua:"+380",by:"+375",kz:"+77",ge:"+995"},t="";for(var o in void 0!==k.W&&(t=k.W.country),e)if(o==t)return e[t];return""},k.getTz=function(){return-(new Date).getTimezoneOffset()/60},k.load_jQuery=function(){var e;k.log("load_jQuery");var t={jquery:"none",widget:_emv.campaign};return void 0!==window.jQuery&&(k.log("Site use jquery "+window.jQuery.fn.jquery),t.jquery=window.jQuery.fn.jquery),void 0!==window.jQuery&&(e=window.jQuery.fn.jquery,0<=inArray.call(k.JQUERY_VERSIONS,e))?(k.log("jQuery "+jQuery.fn.jquery+" is present and meets our requirements."),k.$=window.jQuery,k.init(),k.analytics(t)):(k.log("jQuery is not present."),k.getScript(k.JQUERY_URL,function(){if("undefined"!=typeof jQuery)return k.$=jQuery.noConflict(!0),k.log("jQuery version "+k.$.fn.jquery+" successfully loaded."),k.init(),k.analytics(t)}))},k.getScript=function(e,t){var o,i,n;return k.log("getScript",e),(n=document.createElement("script")).src=e,i=document.getElementsByTagName("head")[0],o=!1,n.onload=n.onreadystatechange=function(){if(!(o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState))return o=!0,t(),n.onload=n.onreadystatechange=null,i.removeChild(n)},i.appendChild(n)},k.loadScript=function(e,t,o){var i,n,a,l;return k.log("loadScript",e),n=!1,a=null,(i=k.$).isFunction(t)?(a=t,n=o||n):(n=t||n,a=o||a),l=!0,i('script[type="text/javascript"]').each(function(){return l=e!==i(this).attr("src")}),l?i.ajax({type:"GET",url:e,success:a,dataType:"script",cache:n}):i.isFunction(a)?a.call(this):void 0},k.generateUUID=function(){var o,e;return k.log("generateUUID"),o=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===e?t:7&t|8).toString(16)}),k.sendUUID(e),e},k.sendUUID=function(e){k.log("sendUUID",e,_emv.campaign),k.$.ajax({type:"GET",url:k.PUBLIC_SERVER+"backend/widget_uuid.php",dataType:"json",data:{widget_key:_emv.campaign,uuid:e,ga_cid:k.getGoogleCid(),ya_cid:k.ya_cid,roistat:k.Cookies.get("roistat_visit")||(void 0!==window.roistat?window.roistat.visit:""),ref:document.referrer,loc:document.location.href,cache:Math.random()},success:function(e){k.log("UUID",e)},error:function(){k.log("UUID error")},dataType:"jsonp",jsonpCallback:"jsonpUuidCallback"})},k.isMobile=function(){return!k.is_vk&&(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|playbook|silk/i.test(navigator.userAgent||navigator.vendor||window.opera)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||window.opera).substr(0,4)))},k.isIpad=function(){return/ipad/i.test(navigator.userAgent||navigator.vendor||window.opera)},k.isIOS=function(){return/ip(hone|od|ad)/i.test(navigator.userAgent||navigator.vendor||window.opera)},k.isTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints||window.DocumentTouch&&document instanceof DocumentTouch},k.mobileButton=function(e,t){k.log("call mobileButton");var o=80/k.screen_width,i=window.innerWidth*o,n=window.innerWidth/2-.5*i+window.pageXOffset,a=window.innerHeight-1.25*i+window.pageYOffset;null!==e&&(e.css("width",i),e.css("height",i),e.css("left",n),e.css("top",a),e.find("object").css("width",i),e.find("img").css("width",i)),t.css("width",k.screen_width+"px"),t.css("height",k.screen_height+"px");var l=k.screen_width/window.innerWidth;t.css("zoom",1/l),t.css("top",window.pageYOffset*l),t.css("left",window.pageXOffset*l)},k.default_viewport=null,k.default_viewport_is_mobile=!1,k.mobileAdoptation=function(){if(k.$("html").hasClass("lb-site-hide")){k.$("html").removeClass("lb-site-hide"),!1===k.default_viewport?k.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=0.33"):k.default_viewport&&k.$("meta[name=viewport]").attr("content",k.default_viewport),(e=k.$("html").data("ldbck_save_scroll"))&&k.$(document).scrollTop(e)}else{var e=k.$(document).scrollTop();if(k.$("html").data("ldbck_save_scroll",e),k.$("html").addClass("lb-site-hide"),0==k.$("meta[name=viewport]").length)k.default_viewport=!1,k.$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">');else if(null===k.default_viewport){k.default_viewport=k.$("meta[name=viewport]").attr("content");for(var t,o=k.default_viewport.split(","),i=!1,n=0;n<o.length;n++){o[n]=o[n].replace(/^\s+/,"");var a=o[n].split("=");"initial-scale"==a[0]&&(t=a[1]),"maximum-scale"==a[0]&&(i=a[1])}if(1==t&&1==i)return void(k.default_viewport_is_mobile=!0);k.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}else k.default_viewport_is_mobile||k.$("meta[name=viewport]").attr("content","width=device-width, initial-scale=1, maximum-scale=1")}var l,r;"1"!=k.W.chat&&(l=k.$("#lb_mobile-call"),r=k.$(".lb_mobile-wrapper"),l&&r&&k.mobileButton(l,r))},k.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},k.randomVal=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},k.log=function(e){var t,o;k.debug_window&&((t=document.getElementById("ldbck_debug_window"))||((t=document.createElement("div")).id="ldbck_debug_window",t.style="position: absolute; top: 0; left: 0; width: 100%; background-color: rgba(0,0,0,.2); color: white; z-index:9999;",document.body.appendChild(t)),document.getElementById("ldbck_debug_window").innerHTML+="<div>"+e+": "+JSON.stringify(arguments)+"</div>"),!ldbck.DEBUG&&"#debug"!=window.location.hash||((o=Array.prototype.slice.call(arguments)).unshift((new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+" "),console.log.apply(console,o))},k.initStorage=function(e){return function(d){var e="ls_",t="ss_";function c(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a,l,r;if(t<2)throw new Error("Minimum 2 arguments must be given");else if(d.isArray(n)){l={};for(var s in n){a=n[s];try{l[a]=JSON.parse(o.getItem(a))}catch(e){l[a]=o.getItem(a)}}return l}else if(t==2){try{return JSON.parse(o.getItem(n))}catch(e){return o.getItem(n)}}else{try{l=JSON.parse(o.getItem(n))}catch(e){throw new ReferenceError(n+" is not defined in this storage")}for(var s=2;s<t-1;s++){l=l[i[s]];if(l===undefined)throw new ReferenceError([].slice.call(i,1,s+1).join(".")+" is not defined in this storage")}if(d.isArray(i[s])){r=l;l={};for(var c in i[s]){l[i[s][c]]=r[i[s][c]]}return l}else{return l[i[s]]}}}function a(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a=i[2],l,r={},s;if(t<2||!d.isPlainObject(n)&&t<3)throw new Error("Minimum 3 arguments must be given or second parameter must be an object");else if(d.isPlainObject(n)){for(var c in n){l=n[c];if(!d.isPlainObject(l))o.setItem(c,l);else o.setItem(c,JSON.stringify(l))}return n}else if(t==3){if(typeof a==="object")o.setItem(n,JSON.stringify(a));else o.setItem(n,a);return a}else{try{s=o.getItem(n);if(s!=null){r=JSON.parse(s)}}catch(e){}s=r;for(var c=2;c<t-2;c++){l=i[c];if(!s[l]||!d.isPlainObject(s[l]))s[l]={};s=s[l]}s[i[c]]=i[c+1];o.setItem(n,JSON.stringify(r));return r}}function n(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a,l;if(t<2)throw new Error("Minimum 2 arguments must be given");else if(d.isArray(n)){for(var r in n){o.removeItem(n[r])}return true}else if(t==2){o.removeItem(n);return true}else{try{a=l=JSON.parse(o.getItem(n))}catch(e){throw new ReferenceError(n+" is not defined in this storage")}for(var r=2;r<t-1;r++){l=l[i[r]];if(l===undefined)throw new ReferenceError([].slice.call(i,1,r).join(".")+" is not defined in this storage")}if(d.isArray(i[r])){for(var s in i[r]){delete l[i[r][s]]}}else{delete l[i[r]]}o.setItem(n,JSON.stringify(a));return true}}function o(e,t){var o=u(e);for(var i in o){n(e,o[i])}if(t){for(var i in d.namespaceStorages){l(i)}}}function r(e){var t=arguments.length,o=arguments,i=window[e],n=o[1];if(t==1){return u(e).length==0}else if(d.isArray(n)){for(var a=0;a<n.length;a++){if(!r(e,n[a]))return false}return true}else{try{var l=c.apply(this,arguments);if(!d.isArray(o[t-1]))l={totest:l};for(var a in l){if(!(d.isPlainObject(l[a])&&d.isEmptyObject(l[a])||d.isArray(l[a])&&!l[a].length||!l[a]))return false}return true}catch(e){return true}}}function s(e){var t=arguments.length,o=arguments,i=window[e],n=o[1];if(t<2)throw new Error("Minimum 2 arguments must be given");if(d.isArray(n)){for(var a=0;a<n.length;a++){if(!s(e,n[a]))return false}return true}else{try{var l=c.apply(this,arguments);if(!d.isArray(o[t-1]))l={totest:l};for(var a in l){if(!(l[a]!==undefined&&l[a]!==null))return false}return true}catch(e){return false}}}function u(e){var t=arguments.length,o=window[e],i=arguments,n=i[1],a=[],l={};if(t>1){l=c.apply(this,i)}else{l=o}if(l&&l._cookie){for(var r in d.cookie()){if(r!=""){a.push(r.replace(l._prefix,""))}}}else{for(var s in l){a.push(s)}}return a}function l(e){if(!e||typeof e!="string")throw new Error("First parameter must be a string");if(g){if(!window.localStorage.getItem(e))window.localStorage.setItem(e,"{}");if(!window.sessionStorage.getItem(e))window.sessionStorage.setItem(e,"{}")}else{if(!window.localCookieStorage.getItem(e))window.localCookieStorage.setItem(e,"{}");if(!window.sessionCookieStorage.getItem(e))window.sessionCookieStorage.setItem(e,"{}")}var t={localStorage:d.extend({},d.localStorage,{_ns:e}),sessionStorage:d.extend({},d.sessionStorage,{_ns:e})};d.namespaceStorages[e]=t;return t}function i(e){var t="jsapi";try{if(!window[e])return false;window[e].setItem(t,t);window[e].removeItem(t);return true}catch(e){return false}}var g=i("localStorage"),h={_type:"",_ns:"",_callMethod:function(e,t){var o=[this._type],t=Array.prototype.slice.call(t),i=t[0];if(this._ns)o.push(this._ns);if(typeof i==="string"&&i.indexOf(".")!==-1){t.shift();[].unshift.apply(t,i.split("."))}[].push.apply(o,t);return e.apply(this,o)},get:function(){return this._callMethod(c,arguments)},set:function(){var e=arguments.length,t=arguments,o=t[0];if(e<1||!d.isPlainObject(o)&&e<2)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(d.isPlainObject(o)&&this._ns){for(var i in o){a(this._type,this._ns,i,o[i])}return o}else{var n=this._callMethod(a,t);if(this._ns)return n[o.split(".")[0]];else return n}},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(n,arguments)},removeAll:function(e){if(this._ns){a(this._type,this._ns,{});return true}else{return o(this._type,e)}},isEmpty:function(){return this._callMethod(r,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(s,arguments)},keys:function(){return this._callMethod(u,arguments)}};if(d.initNamespaceStorage=function(e){return l(e)},g){d.localStorage=d.extend({},h,{_type:"localStorage"});d.sessionStorage=d.extend({},h,{_type:"sessionStorage"})}else{d.localStorage=d.extend({},h,{_type:"localCookieStorage"});d.sessionStorage=d.extend({},h,{_type:"sessionCookieStorage"})}d.namespaceStorages={},d.removeAllStorages=function(e){d.localStorage.removeAll(e);d.sessionStorage.removeAll(e);if(d.cookieStorage)d.cookieStorage.removeAll(e);if(!e){d.namespaceStorages={}}}}(k.$),k.$.initNamespaceStorage("__"+e)},k.coBrowseV2=function(n){k.log("coBrowseV2"),Cloudim.Api.getCurrentOperator(function(i){!1!==i&&void 0===i.length&&Cloudim.Api.getVisitor(function(e){var t=k.$("html").clone();t.find("script").attr("src","").html(""),t.find(".app-cobrowsing").remove(),t.find("#lb_widget-root").html(""),t.find("audio").html(""),t.find("iframe#cloudim_chat").html("");var o={widget_key:k.W.widget_key,user_id:k.W.user_id,guid:k.getCookie(k.cg).guid,loc:document.location.href,operator:i.jid,visitor:e.jid,html:t.html()};k.$.post(k.PUBLIC_SERVER+"backend/widget_cobrowse.php",o,function(e){"function"==typeof n&&n(e)},"json")})})},k.Cookies=function e(h){function p(e,t,o){var i,n;if("undefined"!=typeof document){if(1<arguments.length){"number"==typeof(o=_({path:"/"},p.defaults,o)).expires&&((n=new Date).setMilliseconds(n.getMilliseconds()+864e5*o.expires),o.expires=n),o.expires=o.expires?o.expires.toUTCString():"";try{i=JSON.stringify(t),/^[\{\[]/.test(i)&&(t=i)}catch(e){}t=h.write?h.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var a="";for(var l in o)o[l]&&(a+="; "+l,!0!==o[l]&&(a+="="+o[l]));return document.cookie=e+"="+t+a}e||(i={});for(var r=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,c=0;c<r.length;c++){var d=r[c].split("="),u=d.slice(1).join("=");this.json||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var g=d[0].replace(s,decodeURIComponent),u=h.read?h.read(u,g):h(u,g)||u.replace(s,decodeURIComponent);if(this.json)try{u=JSON.parse(u)}catch(e){}if(e===g){i=u;break}e||(i[g]=u)}catch(e){}}return i}}return(p.set=p).get=function(e){return p.call(p,e)},p.getJSON=function(){return p.apply({json:!0},[].slice.call(arguments))},p.defaults={},p.remove=function(e,t){p(e,"",_(t,{expires:-1}))},p.withConverter=e,p}(function(){}),k.Events={onChatReady:[],onGoalEvent:[],_callEvent:function(e,t){var o=!0;if(void 0!==k.Events[e]&&0<k.Events[e].length)for(var i in k.Events[e])!1===k.Events[e][i](t)&&(o=!1);return o}},k.Api={callTo:function(e,t){var o=t&&"object"!=typeof t?{delayed:t}:t;k.$("#lb_phone").val(e),k.callTo(k.$("#lb_widget-root"),o)},callFromForm:function(e,t){k.$("#lb_phone").val(e);var o={initiator:"magic_forms"};t&&"string"==typeof t&&""!==k.$.trim(t)&&(o.label=t),k.callTo(k.$("#lb_widget-root"),o)},bind:function(e,t){k.Events[e]&&(k.Events[e][k.Events[e].length]=t)}},0<k.onApiReady.length)for(r=0,s=k.onApiReady.length;r<s;r++)"function"==typeof k.onApiReady[r]&&k.onApiReady[r](k.Api);"object"==typeof window.Muse&&"function"==typeof window.muse_init?(k.log("Is Muse site"),k.muse_detect_interval=null,k.muse_interval=150,k.muse_stop_check=5e3,k.muse_step=0,k.muse_detect_interval=setInterval(function(){k.muse_step++,(!0===document.body.classList.contains("initialized")||k.muse_step>=k.muse_stop_check/k.muse_interval)&&(k.log("Muse Is initialized"),clearInterval(k.muse_detect_interval),k.muse_detect_interval=null,k.load_jQuery())},k.muse_interval)):k.load_jQuery()}).call(this);